# CloudBackup
整个云备份项目基于C/S架构开发，分为服务端和客户端。

## 服务端

服务端大致分为三大模块和三小模块：用户管理模块、网络服务模块、文件压缩模块以及配置信息加载模块、数据处理模块、文件工具模块。

### 用户管理模块

服务端的用户管理模块负责接收客户端的登录以及注册请求，并且用 `user.dat` 文件按照 `json` 格式进行管理，在程序启动后用哈希表对用户的账号密码进行组织，方便快速进行用户信息核对。

### 网络服务模块

网络服务模块主要提供了对外的文件上传、文件下载、文件浏览。文件浏览提供了两个接口，分别为 `ListShow` 和 `ListJson` 两个接口，分别返回的html页面和json数据页面，html页面用于浏览器的访问浏览，json数据用于Qt开发的客户端的文件浏览。

网络服务模块的构建依赖了第三方库 `httplib`，该库采用单独的一个头文件，使用起来简单便捷，适合快速进行服务器的构建。

### 文件压缩模块

文件压缩模块的主要功能是对长时间未访问的文件进行压缩处理，以节省磁盘空间。文件压缩功能的实现逻辑是通过两个线程，一个线程对目录进行监控，当目录中有文件变动时，实时更新维护的哈希表，哈希表有文件存储路径和最后一个访问时间组成。另一个线程则对哈希表进行定期检测，用当前时间与文件的最后一次访问时间进行计算，如果时间超出配置文件中定义的热点文件判断时间，则对该文件进行压缩处理。

文件压缩模块的实现依赖第三方库 `zstd` 库以及 `inotify` 事件驱动机制。

### 配置信息加载模块

配置信息加载模块通过单例模式读取配置文件信息，为其他模块的功能提供支持，配置信息用json数据格式进行组织，该功能依赖第三方库 `jsoncpp` 实现。

```cpp
{
  "hot_time" : 5,
  "server_port" : 8080,
  "server_ip" : "0.0.0.0",
  "pack_suffix" : ".lz",
  "pack_dir" : "./packdir/",
  "back_dir" : "./backdir/",
  "download_preffix" : "/download/",
  "backup_file" : "./cloud.dat"
}
```

### 数据处理模块

数据处理模块通过将备份的文件信息用哈希表组织起来，按照URL和文件主要信息进行组合形成键值对，从而可以进行快速的文件查找。

### 文件工具模块

该模块提供了大量的文件处理相关的接口，在需要时直接使用。

## 客户端

云备份的客户端基于Qt框架开发，支持文件的上传备份和文件的下载，在开始使用时，需要先登录软件，提供了简洁的登录和注册功能，像服务器发送请求。
